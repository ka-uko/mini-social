{% load static %}
<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}Банное сообщество{% endblock %}</title>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons (сердечки и т.п.) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <!-- Наши стили -->
    <link href="{% static 'css/app.css' %}" rel="stylesheet">
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
      <div class="container">
        <a class="navbar-brand" href="{% url 'home' %}">БаняNet</a>

        <!-- burger -->
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="mainNav">
          <!-- ЛЕВАЯ часть -->
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            {% if user.is_authenticated %}
              <li class="nav-item">
                <a class="nav-link" href="{% url 'profile' user.username %}">Профиль</a>
              </li>
              <li class="nav-item">
                <a class="nav-link d-flex align-items-center gap-1 {% if has_unread %}text-warning fw-bold{% endif %}"
                   href="{% url 'inbox' %}">
                  Сообщения
                  {% if unread_count %}
                    <span class="badge bg-warning text-dark">{{ unread_count }}</span>
                  {% endif %}
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link d-flex align-items-center gap-1" href="{% url 'notify_inbox' %}">
                  Уведомления
                  {% if notify_unread %}
                    <span class="badge bg-warning text-dark">{{ notify_unread }}</span>
                  {% endif %}
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link {% if feed == 'sub' %}active{% endif %}" href="{% url 'home' %}?feed=sub">Подписки</a>
              </li>
            {% endif %}

            <!-- Поиск: занимает всю ширину в «бургер-режиме», компактный на широких -->
            <li class="nav-item w-100 w-lg-auto mt-2 mt-lg-0">
              <form class="d-flex" role="search" action="{% url 'search' %}">
                <input class="form-control form-control-sm me-2 search-input flex-grow-1"
                       type="search" placeholder="Поиск" name="q" value="{{ request.GET.q }}">
                <button class="btn btn-sm btn-outline-light">Найти</button>
              </form>
            </li>
          </ul>

          <!-- ПРАВАЯ часть -->
          <ul class="navbar-nav ms-auto align-items-lg-center">
            {% if user.is_authenticated %}
              <li class="nav-item">
                <span class="nav-link nav-hello d-none d-lg-inline">Привет, {{ user.username }}</span>
              </li>
              <li class="nav-item logout-form ms-lg-2 mt-2 mt-lg-0">
                <form method="post" action="{% url 'logout' %}">
                  {% csrf_token %}
                  <button type="submit" class="btn btn-outline-light btn-sm w-100 w-lg-auto logout-btn">Выход</button>
                </form>
              </li>
            {% else %}
              <li class="nav-item"><a class="nav-link" href="{% url 'login' %}">Вход</a></li>
              <li class="nav-item"><a class="nav-link" href="{% url 'signup' %}">Регистрация</a></li>
            {% endif %}
          </ul>
        </div>
      </div>
    </nav>

    <main class="container">
      {% if messages %}
        <div class="my-2">
          {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">{{ message }}</div>
          {% endfor %}
        </div>
      {% endif %}

      {% block content %}{% endblock %}
    </main>

    <!-- Bootstrap JS (обязательно bundle: включает Popper и Collapse) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Наш JS (после Bootstrap) -->
    <script src="{% static 'js/app.js' %}"></script>
  </body>
</html>
